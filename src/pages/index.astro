---
import BaseLayout from '@/layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

export const prerender = true;

// Load posts (non-drafts), newest first
const posts = (await getCollection('posts', ({ data }) => !data.draft))
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime());

const title = 'Blog — Flax Lignan Health';
---

<BaseLayout>
  <!-- Put the page title into the <title> slot in BaseLayout -->
  <Fragment slot="title">{title} — </Fragment>

  <header class="blog-header">
    <h1>Blog</h1>
    <p class="lede">Research-driven insights and site updates.</p>
  </header>

  <main class="blog-list" aria-labelledby="blog-listing">
    {posts.length === 0 ? (
      <p>No posts yet. Check back soon.</p>
    ) : (
      posts.map((post) => (
        <article class="post-card">
          <h2 class="post-title">
            <a href={`/blog/${post.slug}/`} class="post-link">
              {post.data.title}
            </a>
          </h2>

          <p class="meta">
            {post.data.date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}
            {post.data.tags?.length ? ` • ${post.data.tags.join(', ')}` : ''}
          </p>

          {post.data.description && <p class="excerpt">{post.data.description}</p>}
        </article>
      ))
    )}
  </main>

  <style>
    .blog-header {
      max-width: 1100px;
      margin: 0 auto 8px;
      padding: 0 16px;
      border-bottom: 1px solid #e5e7eb;
    }
    .blog-header h1 {
      font-weight: 700;
      margin: .5rem 0 .25rem;
    }
    .lede {
      color: #555;
      margin: 0 0 .9rem;
    }

    .blog-list {
      max-width: 1100px;
      margin: 0 auto;
      padding: 1rem 16px 2.5rem;
    }
    .post-card {
      padding: .6rem 0 1rem;
      border-bottom: 1px solid #eee;
    }
    .post-title {
      margin: 0 0 .25rem;
      font-weight: 700;
    }
    .post-link {
      color: inherit;
      text-decoration: underline;
      position: relative;
      z-index: 2;             /* belt-and-suspenders clickability */
      pointer-events: auto;
    }
    .meta {
      color:#555;
      margin: 0 0 .5rem;
    }
    .excerpt {
      margin: 0;
    }
  </style>
</BaseLayout>
